\ProvidesPackage{addressbook2}
\usepackage{times}
\usepackage{babel}
\usepackage{graphicx}
\usepackage{layout}
\usepackage{parskip}
\usepackage{ulem}
\usepackage{ragged2e}
\usepackage{type1cm}
\usepackage{fp}
\usepackage{makeidx}
\usepackage{pbox}
\usepackage{multicol}
\usepackage{varwidth}
%\usepackage{hyperref}
\usepackage[
	paperwidth=105mm,
	paperheight=148mm,
	top=10mm,
	bottom=10mm,
	inner=10mm,
	outer=10mm,
	includefoot, footskip=12pt,footnotesep=1pt,twoside]
{geometry}
\newcommand{\Init}[0]{
	%\setlength{\parskip}{0mm plus1ex minus0mm}
	\setlength{\parskip}{0cm}
	\setcounter{LTchunksize}{1000}
	\setlength\fboxsep{0pt}
	\FPmessagesfalse
	%\FPdebugtrue
	\setlength{\cftbeforechapskip}{2ex}
	\setlength{\cftbeforesecskip}{2.5ex}
}
\newcommand*{\l@province}{\@dottedtocline{0}{0em}{0em}}
\newcommand*{\l@district}{\@dottedtocline{0}{1em}{0em}}
\newcommand*{\l@meeting}{\@dottedtocline{0}{2em}{0em}}

\newcommand{\MakeTOC}[0]{
%\xxRescaleFonts{80}
	\setlength{\columnseprule}{1pt}
	\setlength{\columnsep}{10pt}
	\begin{multicols}{2}
		\tableofcontents
	\end{multicols}
%\clearpage
%\xxRescaleFonts{125}
}
\newcommand{\PrintIndex}[0]{
\printindex
}
\newcount\TempCnt
\newcount\FontScaleCnt
\newcount\ProvFontCnt
\newcount\DistFontCnt
\newcount\MedSmallFontCnt
\newcount\NormalFontCnt
\newcount\SmallFontCnt
\newcount\VSmallFontCnt
\newcommand{\SelectFontSize}[1]{\fontsize {#1}{#1} \selectfont}

%\newcommand{\SelectFontSizeScaled}[2]{\FPmul\TempCnt{#2}{#1}
%\SelectFontSize{\TempCnt}}
\providecommand{\ProvHFont}[0]{\SelectFontSize{\ProvFontCnt}} \providecommand{\DistrictHFont}[0]{\SelectFontSize{\DistFontCnt}}
\providecommand{\MtgHFont}[0]{\SelectFontSize{\NormalFontCnt}}
\providecommand{\ProvHIdxFont}[0]{\SelectFontSize{\DistFontCnt}}
\providecommand{\DistrictHIdxFont}[0]{\SelectFontSize{\NormalFontCnt}}
\providecommand{\MtgHIdxFont}[0]{\SelectFontSize{\MedSmallFontCnt}}
\providecommand{\SurnameFont}[0]{\SelectFontSize{\SmallFontCnt}}
\providecommand{\PhoneFont}[0]{\SelectFontSize{\SmallFontCnt}}
\providecommand{\CompactMtgBodyFont}[0]{\SelectFontSize{\SmallFontCnt}}
\providecommand{\MtgPropsFont}[0]{\SelectFontSize{\VSmallFontCnt}}
\providecommand{\AddressFont}[0]{\SelectFontSize{\VSmallFontCnt}}

\newcommand{\xxClipCounters}[0]{
\FPclip\ProvFontCnt{\ProvFontCnt{}}
\FPclip\DistFontCnt{\DistFontCnt{}}
\FPclip\MedSmallFontCnt{\MedSmallFontCnt{}}
\FPclip\NormalFontCnt{\NormalFontCnt{}}
\FPclip\SmallFontCnt{\SmallFontCnt{}}
\FPclip\VSmallFontCnt{\VSmallFontCnt{}}
}
\newcommand{\xxFontScaling}[1]{
\FPset\FontScaleCnt{#1}% \FPprint\FontScaleCnt
\xxCustomSize
}
\newcommand{\xxCustomSize}[0]{
\FPmul\ProvFontCnt{0.16}{\FontScaleCnt{}} 
\FPmul\DistFontCnt{0.14}{\FontScaleCnt{}} 
\FPmul\NormalFontCnt{0.13}{\FontScaleCnt{}}
\FPmul\MedSmallFontCnt{0.12}{\FontScaleCnt{}} 
\FPmul\SmallFontCnt{0.10}{\FontScaleCnt{}} 
\FPmul\VSmallFontCnt{0.09}{\FontScaleCnt{}} 
\xxClipCounters
}

\newcommand{\xxRescaleFonts}[1]{
%\FPmul\ProvFontCnt{16}{#1} 
%\FPdiv\ProvFontCnt{\ProvFontCnt{}}{100}
\xxClipCounters
}

\newcommand{\xxColWidths}[2]{
\newdimen\SurnameDim
\SurnameDim=#1
\newdimen\PhoneDim
\PhoneDim=#2
\newdimen\AddrDim
\AddrDim=\textwidth
\advance \AddrDim by -\SurnameDim
\advance \AddrDim by -\PhoneDim
\newdimen\AddrPhoneDim 
\AddrPhoneDim \AddrDim
\advance\AddrPhoneDim by \PhoneDim
\newdimen\SurAddrDim 
\SurAddrDim \AddrDim
\advance\SurAddrDim \SurnameDim
\newdimen\SurAddrPhoneDim 
\SurAddrPhoneDim\SurAddrDim
\advance\SurAddrPhoneDim by \PhoneDim
}
\providecommand{\CSSurnameWidth}[0]{\SurnameDim}
\providecommand{\CSAddressWidth}[0]{\AddrDim}
\providecommand{\CSPhoneWidth}[0]{\PhoneDim}
\providecommand{\CSAddressPhoneWidth}[0]{\AddrPhoneDim}
\providecommand{\CSSurAddressWidth}[0]{\SurAddrDim}
\providecommand{\CSSurAddressPhoneWidth}[0]{\SurAddrPhoneDim}


\newcommand{\CSXSmall}[0]{
\xxColWidths{18mm}{21mm}
\xxFontScaling{70}\relax
}
\newcommand{\CSSmall}[0]{
\xxColWidths{18mm}{22mm}
\xxFontScaling{80}\relax
}
\newcommand{\CSNormal}[0]{
\xxColWidths{18mm}{25mm}
\xxFontScaling{90}\relax
}
\newcommand{\CSLarge}[0]{
\xxColWidths{18mm}{26mm}
\xxFontScaling{100}\relax
}
\newcommand{\CSXLarge}[0]{
\xxColWidths{18mm}{27mm}
\xxFontScaling{110}\relax
}

\newcommand{\xxOneVFil}[0]{\vskip 0pt plus 1fil}
\newcommand{\xxTwoVFil}[0]{\vskip 0pt plus 2fil}
\newcommand{\xxPreProvFil}[0]{\xxTwoVFil}
\newcommand{\xxPostProvFil}[0]{}
\newcommand{\xxPreDistFil}[0]{\xxTwoVFil}
\newcommand{\xxPostDistFil}[0]{}
\newcommand{\xxPreMtgFil}[0]{\xxTwoVFil}
\newcommand{\xxPostMtgFil}[0]{\xxOneVFil}
\def\ulineB{\bgroup \ULdepth=0.1ex \ULset}

\newcommand{\ProvH}[1]{\ProvHFont \scshape \centering{ #1} \par \nobreak\vskip -1ex \xxPreProvFil\index{#1@{\ProvHIdxFont\scshape#1}} \addcontentsline{toc}{province}{#1}\nobreak\xxPostProvFil}

\newcommand{\DistrictH}[1]{\xxPreDistFil\normalfont\DistrictHFont\centering{#1}\par \nobreak\vskip-1ex\xxPostDistFil
\index{#1@{\DistrictHIdxFont\textit{#1}}}\addcontentsline{toc}{district}{#1}\nobreak}
\newcommand{\MeetingH}[1]{\xxPreMtgFil\normalfont \MtgHFont \vskip -0.7ex
	\raggedright{\ulineB{#1}}\par \nobreak\xxPostMtgFil \index{#1@{\normalfont \MtgHIdxFont{#1}}}\addcontentsline{toc}{meeting}{#1}\nobreak}

\newcommand{\Surname}[1]{\Centering{\textbf{\SurnameFont#1}\strut}}
\newcommand{\MtgProps}[1]{\def\testa{#1} \def\testb{}
	\ifx\testb\testa {} \else \MtgPropsFont \textit{#1} \fi } 
\newcommand{\CompactMtgProps}[1]{\def\testa{#1} \def\testb{}
	\ifx\testb\testa {} \else\hskip 0.2em\CompactMtgBodyFont\textit{(#1)}\fi }
\newcommand{\Address}[1]{\raggedright{\AddressFont  #1 }}
\newcommand{\Phone}[1]{\raggedleft{\PhoneFont #1}}
\newcommand{\MockPhone}[1]{\PhoneFont{ #1}}

\newcommand{\SurnameWidth}[0]{\CSSurnameWidth}
\newcommand{\AddressWidth}[0]{\CSAddressWidth}
\newcommand{\PhoneWidth}[0]{\CSPhoneWidth}
\newcommand{\TextWidth}[0]{88mm}
\newcommand{\RuleWidth}[0]{87mm}

\newbox\PhoneListBox
\newbox\TempBox
\newbox\DetailsBox
\newbox\AddressBox
\newbox\HomeBox
\newbox\LeftBox

\newcommand{\xxHome}[4]{
%\baselineskip=-1000pt
\lineskip=0.3ex
\lineskiplimit\maxdimen

\setlength\fboxsep{0pt}

\setbox\PhoneListBox=\hbox{\PhoneFont \pbox[t]{1\textwidth}{#4}}

\ifdim\wd\PhoneListBox<.4\textwidth
	\setbox\PhoneListBox=\vtop{\hsize =1\wd\PhoneListBox \Phone{#4}}
\else
	\setbox\PhoneListBox=\vtop{\hsize =0.4\textwidth \Phone{#4}}
\fi

\setbox\TempBox=\hbox{{\Surname{#1}}} 
\setbox\DetailsBox=\hbox{\hskip -0.45em\raggedright{\MtgProps{#2}}}
\setbox\LeftBox=\vtop{
	\hsize=\SurnameWidth \box\TempBox \def\testa{#2} \def\testb{}
	\ifx\testb\testa {} \else  \vskip -0.5ex \box\DetailsBox \fi }
\dimen0=\wd\LeftBox
\wd\LeftBox=0pt
\advance \dimen0 by 0.2em
\dimen3=\textwidth
\advance\dimen3 by -\wd\PhoneListBox
\dimen1=\dimen3
\dimen2=\dimen3
\advance\dimen1 by -1\dimen0
\advance\dimen2 by -1em
\def\testa{#2} \def\testb{}
\ifx\testb\testa 
	\setbox\AddressBox=\hbox{\raise 0.15ex
	\vtop{\hsize=\dimen3
	\parshape 2 \dimen0 \dimen1 1em \dimen2
	\Address {\strut#3}}}
\else
	\setbox\AddressBox=\hbox{\raise 0.15ex
	\vtop{ 
	\hsize=\dimen3 
	\parshape 3 \dimen0 \dimen1 \dimen0 \dimen1 
	1em \dimen2	\Address {#3}}}
\fi
\ifx\testb\testa 
	\setbox\TempBox=\vtop{\hsize=\dimen3
	\parshape 2 \dimen0 \dimen1 \dimen0 \dimen1
	\Address {#3}}
\else
	\setbox\TempBox=\hbox{\raise 0.15ex\vtop{ 
	\hsize=\dimen3 
	\parshape 3 \dimen0 \dimen1 \dimen0 \dimen1 
	\dimen0 \dimen1	\Address {#3}}}
\fi

\ifdim\dp\AddressBox<\dp\TempBox
\else
	\setbox\AddressBox=\box\TempBox
\fi

\setbox\HomeBox= \vtop{\hbox{\hskip-0.25em \box\LeftBox
%	\fbox
		{\box\AddressBox} 
%	\hskip-0.24em		\fbox
		{\box\PhoneListBox}}		
		}
%\showbox\HomeBox
{\box\HomeBox}
\nobreak	 	\vskip 1pt \xxOneVFil		
\hrule height.5pt depth.0pt
\xxOneVFil
}

\newcommand{\Home}[4]{
\def\testa{#4} \def\testb{}
\ifx\testb\testa 
	\renewcommand{\AddressWidth}[0]{\CSSurAddressPhoneWidth}
	\renewcommand{\PhoneWidth}[0]{0pt}
\else
	\renewcommand{\AddressWidth}[0]{\CSSurAddressWidth}
	\renewcommand{\PhoneWidth}[0]{\CSPhoneWidth}
\fi
\xxHome{#1}{#2}{#3}{#4}
}
\newcommand{\CompactProvH}[1]{
\ProvH{#1}
}
\newcommand{\CompactDistrictH}[1]{
\DistrictH{#1}
}
\newcommand{\CompactMeetingH}[1]{
\MeetingH{#1}\vskip-1ex
}
\newcommand{\MLProvH}[1]{
\ProvH{#1}
}
\newcommand{\MLDistrictH}[1]{
\DistrictH{#1}
}
\newcommand{\MLMeetingH}[1]{
\vskip 0.5ex\MeetingH{#1}\vskip-0.8ex
}
\newcommand{\MLHome}[3]{\hskip-0.25em\CompactMtgBodyFont\textbf{#1}\hskip-0.6em\CompactMtgProps{#2}\CompactMtgBodyFont#3\\
}

\newcommand{\CompactHome}[3]{\hskip-0.25em\CompactMtgBodyFont\textbf{#1}\hskip-0.6em\CompactMtgProps{#2}\CompactMtgBodyFont#3;
}
\newcommand{\BeginHomes}[0]{} 
\newcommand{\EndHomes}[0]{}
\newcommand{\BeginCompactHomes}[0]{} 
\newcommand{\EndCompactHomes}[0]{\par}
\newcommand{\BeginMLHomes}[0]{} 
\newcommand{\EndMLHomes}[0]{}
\newcommand{\EndSection}[0]{\vfill\clearpage}

\newcommand{\StartCompactMtgs}[0]{} 
\newcommand{\StartMtgList}[0]{} 
\newcommand{\StartPhoneList}[0]{} 
\newcommand{\StartZim}[0]{} 
