name: Compile Latex File
permissions: write-all

on: 
  workflow_dispatch:
  push:
    paths:
      - '**.tex'

env:
  USE_CACHE: true
  ETL_FOLDER: download-and-convert-gdocs
  TEX_FOLDER: my-awesome-cv
  PD_FOLDER: my-awesome-cv/cv/personal_data

jobs:
  
  Get-Docker-Images-and-Compile:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
    - uses: actions/checkout@v3

    - name: Output Inputs
      run: echo "${{ toJSON(github.event.client_payload) }}"

    - name: Pull Image
      run: |
        docker pull thomasweise/docker-texlive-thin
      shell: bash

    - name: Complie XeLaTex Document
      run: |
        docker run --rm --user $(id -u):$(id -g) -i -w "/doc" -v "$PWD":/doc thomasweise/docker-texlive-thin make
      shell: bash
    
    - uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: Apply php-cs-fixer changes
        file_pattern: '*.pdf'
