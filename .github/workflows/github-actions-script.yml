name: Download Data and Render pdf file
on: 
  workflow_dispatch:
  push:
    paths:
      - '**.tex'

env:
  USE_CACHE: true
  ETL_FOLDER: download-and-convert-gdocs
  TEX_FOLDER: output
  PD_FOLDER: my-awesome-cv/cv/personal_data

jobs:
  Get-Docker-Images-and-Compile:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Output Inputs
      run: echo "${{ toJSON(github.event.client_payload) }}"

    - name: Pull Image
      run: |
        docker pull thomasweise/docker-texlive-thin
      shell: bash

    - name: Complie XeLaTex Document
      run: |
        cd $TEX_FOLDER
        docker run --rm --user $(id -u):$(id -g) -i -w "/doc" -v "$PWD":/doc thomasweise/docker-texlive-thin make
      shell: bash

    - name: Archive code output.pdf
      uses: actions/upload-artifact@v4
      with:
        name: zipped_cv
        path: ${{ env.TEX_FOLDER }}/output.pdf
        retention-days: 30

    - uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: Apply php-cs-fixer changes
        file_pattern: '*.pdf'
