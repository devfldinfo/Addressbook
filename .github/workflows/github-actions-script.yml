name: Compile Latex File
permissions: write-all
on:
  workflow_dispatch:
  push:
    paths:
      - '**.tex'
      
env:
  outputtex: output.tex

jobs:
  Get-Docker-Images-and-Compile:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Pull Image
      run: |
        docker pull thomasweise/docker-texlive-thin
      shell: bash

    - name: Complie XeLaTex Document
      run: |
        docker run --rm --user $(id -u):$(id -g) -i -w "/doc" -v "$PWD":/doc thomasweise/docker-texlive-thin make
      shell: bash
    
    - uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: Apply php-cs-fixer changes
        file_pattern: '*.pdf'

    - name: Remove output.tex file
      run: |
        if [ -f ${{outputtex}}]; then
          rm ${{outputtex}}
          echo "output.tex file removed."
        else
          echo "output.tex file not found."
          exit  1
        fi
      shell: bash
      
    - name: Commit changes
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add ${{outputtex}}
        git commit -m "Remove output.tex file"
        git push
      shell: bash
